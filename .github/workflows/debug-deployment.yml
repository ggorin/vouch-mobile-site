# Debug workflow to fetch Sevalla deployment details
name: Debug Sevalla Deployment

on:
  workflow_dispatch:
    inputs:
      deployment_id:
        description: 'Deployment ID to check (leave empty for latest)'
        required: false
        type: string

jobs:
  debug:
    name: Fetch Deployment Info
    runs-on: ubuntu-latest

    steps:
      - name: Get static site info
        env:
          SEVALLA_TOKEN: ${{ secrets.SEVALLA_TOKEN }}
          STATIC_SITE_ID: ${{ secrets.SEVALLA_STATIC_SITE_ID }}
        run: |
          echo "=== STATIC SITE INFO ==="
          curl -s \
            -H "Authorization: Bearer $SEVALLA_TOKEN" \
            "https://api.sevalla.com/v2/static-sites/$STATIC_SITE_ID" | jq '.'

      - name: Get recent deployments
        env:
          SEVALLA_TOKEN: ${{ secrets.SEVALLA_TOKEN }}
          STATIC_SITE_ID: ${{ secrets.SEVALLA_STATIC_SITE_ID }}
        run: |
          echo "=== RECENT DEPLOYMENTS ==="
          curl -s \
            -H "Authorization: Bearer $SEVALLA_TOKEN" \
            "https://api.sevalla.com/v2/static-sites/$STATIC_SITE_ID/deployments" | jq '.'

      - name: Get specific deployment details
        env:
          SEVALLA_TOKEN: ${{ secrets.SEVALLA_TOKEN }}
          DEPLOYMENT_ID: ${{ inputs.deployment_id }}
        run: |
          if [ -n "$DEPLOYMENT_ID" ]; then
            echo "=== DEPLOYMENT DETAILS: $DEPLOYMENT_ID ==="
            curl -s \
              -H "Authorization: Bearer $SEVALLA_TOKEN" \
              "https://api.sevalla.com/v2/static-sites/deployments/$DEPLOYMENT_ID" | jq '.'
          fi
